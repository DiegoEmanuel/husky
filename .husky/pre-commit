#!/bin/sh
# ğŸ“¢ Arquivo supervisionado por: HUSKY, O FRANGO GUARDIÃƒO DOS COMMITS ğŸš¨
# Se vocÃª ler isso, ganhou 10 pontos nerds! ğŸ®

# ---------------------------
# CÃ“DIGO DE DEFESA CONTRA COMMIT RUIM
# (NÃ£o mexa se nÃ£o souber o que estÃ¡ fazendo)
# ---------------------------

# ğŸ§¹ ETAPA 1: FAXINA OBRIGATÃ“RIA
echo "ğŸ” CocoricÃ³! Faxinando o cÃ³digo..."
dart fix --apply || {
  echo "ğŸ¦¤ Ah nÃ£o! Algo deu errado na faxina (quem derramou cafÃ© no cÃ³digo?)";
  exit 1;
}

# ğŸ” ETAPA 2: MODO SHERLOCK HOLMES ATIVADO
echo "ğŸ•µï¸â™‚ï¸ Checando se vocÃª nÃ£o esqueceu um widget solto por aÃ­..."
flutter analyze || {
  echo "ğŸš¨ ALERTA DE FRANGO: Tem warnings aÃ­, chefia!";
  echo "ğŸ’¡ Dica: Talvez tenha um 'print' esquecido (sempre tem)";
  exit 1;
}

# ğŸ§ª ETAPA 3: RITUAL DOS TESTES SAGRADOS
echo "ğŸ§™â™‚ï¸ LanÃ§ando feitiÃ§o de verificaÃ§Ã£o de testes..."
flutter test --no-pub --coverage || {
  echo "ğŸ’€ COMMIT BLOQUEADO!";
  echo "ğŸ¤¡ Motivo: Teste falhou (provavelmente aquele que vocÃª pensou 'depois eu arrumo')";
  exit 1;
}

# ğŸ“ˆ ETAPA 4: VERIFICAÃ‡ÃƒO DE COBERTURA (SIM, ISSO Ã‰ UM SEQUESTRO)
echo "ğŸ“‰ Verificando se vocÃª nÃ£o tÃ¡ fazendo corpo mole nos testes..."
dart run tool/verify_coverage.dart || {
  echo "âŒ FRANGO INDIGNADO: Cobertura insuficiente!";
  echo "ğŸ‘‰ FaÃ§a mais testes que nem naqueles tutoriais do YouTube";
  exit 1;
}

# ---------------------------
# SE CHEGOU ATÃ‰ AQUI... PARABÃ‰NS! ğŸ‰
# ---------------------------
echo "ğŸš€ Commit autorizado! VocÃª Ã© quase um sÃªnior agora (quase) ğŸ˜"